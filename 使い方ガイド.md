# 琴平エネルギーデータ統合可視化

## 🎯 概要

3つのCSVファイルのデータを1つのグラフに統合して表示します。

### 📊 表示されるデータ

1. **SOC (%)** - 蓄電池の残量 (青色の線)
   - ファイル: `kotohira_soc_20250801~now (1).csv`
   - 左側のy軸に表示 (0-100%)

2. **実績値kW** - 実際の電力消費/発電 (赤色の線)
   - ファイル: `kotohira_jiseki_20250801~now (1).csv`
   - 右側のy軸に表示

3. **需要計画kW (基準値)** - 計画された需要 (緑色の破線)
   - ファイル: `kotohira_kijyunchi_20250801~now (1).csv`
   - 右側のy軸に表示

## 🚀 使い方

### スクリプトの実行

```bash
cd /Users/takeda/Documents/github/SOC
python3 three_metrics_visualization.py
```

### 生成されるファイル

1. **kotohira_3metrics_integrated.html** (20MB)
   - 全期間のデータを表示 (2025年8月1日～10月27日)
   - 252,458件のSOCレコード
   - 134,699件の実績値レコード
   - 770件の需要計画レコード

2. **kotohira_3metrics_7days.html** (5.9MB)
   - 最初の7日間を表示 (2025年8月1日～8月7日)
   - より詳細に確認しやすい

## 📈 データ統計

### SOC (蓄電池残量)
- **範囲**: 5.0% ～ 100.0%
- **平均**: 51.9%
- **期間**: 2025-08-01 00:00 ～ 2025-10-27 16:43

### 実績値kW (実際の電力)
- **範囲**: -2,217kW ～ 2,138kW
- **平均**: 43.6kW
- **負の値**: 発電している状態
- **正の値**: 消費している状態

### 需要計画kW (基準値)
- **範囲**: 0kW ～ 1,998kW
- **平均**: 310.4kW
- **期間**: 2025-08-01 20:00 ～ 2025-11-07 18:00

## 🎨 グラフの特徴

### インタラクティブ機能
- **ズーム**: ドラッグして拡大
- **パン**: クリック&ドラッグで移動
- **ホバー**: カーソルを合わせると詳細表示
- **凡例クリック**: 各データの表示/非表示切替

### 視覚的な工夫
- **SOC**: 青色の実線 (左軸 0-100%)
- **実績値kW**: 赤色の実線 (右軸)
- **需要計画kW**: 緑色の破線 (右軸、階段状)
- **統一ホバー**: x軸で3つのデータを同時表示

## 📝 スクリプトファイル

- **three_metrics_visualization.py** - メインスクリプト
  - `create_three_metrics_graph()` - 全期間のグラフ作成
  - `create_focused_three_metrics_graph()` - 7日間のグラフ作成

## 💡 使用例

### ブラウザでHTMLファイルを開く

```bash
# macOSの場合
open kotohira_3metrics_integrated.html

# または
open kotohira_3metrics_7days.html
```

### カスタマイズ

期間を変更したい場合は、スクリプトの以下の部分を編集:

```python
# 7日間表示の開始日を変更
start_date = pd.Timestamp('2025-08-01', tz='Asia/Tokyo')
end_date = start_date + timedelta(days=7)  # 日数を変更
```

## 🔧 必要なパッケージ

```bash
pip3 install pandas plotly
```

## 📊 グラフの読み方

1. **SOCが上昇** → 蓄電池が充電されている
2. **SOCが下降** → 蓄電池が放電されている
3. **実績値kWが負** → 発電している(売電)
4. **実績値kWが正** → 消費している(買電)
5. **需要計画kW(基準値)** → 予定されていた需要

## ✨ ポイント

- 3つのデータが時系列で同期して表示されるため、相関関係が一目で分かります
- SOCと実績値kWの関係性を視覚的に把握できます
- 基準値(需要計画kW)と実績値kWの差異を確認できます