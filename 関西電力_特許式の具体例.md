# é–¢è¥¿é›»åŠ› ç‰¹è¨± JP 7377392 B1 ã®å…·ä½“çš„ãªå¼

## ğŸ“‹ ç‰¹è¨±æƒ…å ±

- **ç‰¹è¨±ç•ªå·**: JP 7377392 B1
- **ç™ºè¡Œæ—¥**: 2023å¹´11æœˆ9æ—¥
- **ç™ºæ˜åç§°**: è“„é›»æ± ã‹ã‚‰ä¾›å‡ºå¯èƒ½ãªé›»åŠ›ã‚’ç®—å‡ºã™ã‚‹è£…ç½®
- **å‡ºé¡˜äºº**: é–¢è¥¿é›»åŠ›æ ªå¼ä¼šç¤¾
- **å‚ç…§æ®µè½**: ã€ï¼ï¼ï¼˜ï¼’ã€‘

---

## ğŸ“ ç‰¹è¨±ã«è¨˜è¼‰ã•ã‚ŒãŸå¼

### ã€ï¼ï¼ï¼˜ï¼’ã€‘æ®µè½ã®åŸæ–‡

#### **å¼1: åŸºæº–å€¤ã®è¨ˆç®—å¼**

```
B_{n+1} Ref = (X - (B_n SOC_N + B_n Ref Ã— (T-N))) / T
```

#### **å¼2: ä¾›å‡ºå¯èƒ½é›»åŠ›ã®è¨ˆç®—å¼**

```
B_{n+1} Bid = ((B_n SOC_N - (B_n Bid - B_n Ref) Ã— (T-N)) / T) + B_{n+1} Ref
```

---

## ğŸ“ å¤‰æ•°ã®å®šç¾©

| å¤‰æ•° | èª¬æ˜ | å˜ä½ |
|------|------|------|
| `T` | ãƒ–ãƒ­ãƒƒã‚¯ã®æ™‚é–“ | h (æ™‚é–“) |
| `N` | ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹å¾Œã®çµŒéæ™‚é–“ | h (æ™‚é–“) |
| `B_n SOC_N` | ãƒ–ãƒ­ãƒƒã‚¯B_né–‹å§‹å¾ŒNæ™‚é–“ã«ãŠã‘ã‚‹æ®‹å®¹é‡ | Wh |
| `B_n Bid` | ãƒ–ãƒ­ãƒƒã‚¯B_nã«ãŠã‘ã‚‹ä¾›å‡ºå¯èƒ½é›»åŠ› | W |
| `B_n Ref` | ãƒ–ãƒ­ãƒƒã‚¯B_nã«ãŠã‘ã‚‹åŸºæº–å€¤ | W |
| `X` | è“„é›»æ± ã®å®šæ ¼å®¹é‡ | Wh |
| `B_{n+1} Ref` | æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯B_{n+1}ã®åŸºæº–å€¤ | W |
| `B_{n+1} Bid` | æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯B_{n+1}ã®ä¾›å‡ºå¯èƒ½é›»åŠ› | W |

---

## â° ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚º (GC) æ™‚ç‚¹ã®ç°¡ç•¥åŒ–

### ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºã¨ã¯

- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ–ãƒ­ãƒƒã‚¯é–‹å§‹ã®1æ™‚é–“å‰ï¼ˆå®Ÿéœ€çµ¦é–‹å§‹ã®1æ™‚é–“å‰ï¼‰
- **N = 0ã®å ´åˆ**: å‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã®é–‹å§‹ç›´å¾Œ
- **ç›®çš„**: æ¬¡ã®ãƒ–ãƒ­ãƒƒã‚¯ã®åŸºæº–å€¤ã¨ä¾›å‡ºå¯èƒ½é›»åŠ›ã‚’æœ€çµ‚æ±ºå®š

### N = 0 ã®å ´åˆã®ç°¡ç•¥åŒ–

#### **å¼1ã®ç°¡ç•¥åŒ–: åŸºæº–å€¤**

å…ƒã®å¼:
```
B_{n+1} Ref = (X - (B_n SOC_N + B_n Ref Ã— (T-N))) / T
```

N = 0 ã‚’ä»£å…¥:
```
B_{n+1} Ref = (X - (B_n SOC_0 + B_n Ref Ã— (T-0))) / T
            = (X - (B_n SOC_0 + B_n Ref Ã— T)) / T
            = (X - B_n SOC_0 - B_n Ref Ã— T) / T
```

ã•ã‚‰ã«ã€ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ç‚¹ã§ã¯å‰ãƒ–ãƒ­ãƒƒã‚¯ã®è¨ˆç”»ãŒå®Œäº†ã—ã¦ã„ã‚‹ãŸã‚ã€
`B_n SOC_0` ã‚’ãƒ–ãƒ­ãƒƒã‚¯B_né–‹å§‹æ™‚ã®SOCã¨ã™ã‚‹ã¨:

```
B_{n+1} Ref = (X - B_n SOC_start) / T
```

**å®Ÿç”¨çš„ã«ã¯:**
```
B_{n+1} Ref = (ç›®æ¨™å®¹é‡ - ç¾åœ¨å®¹é‡) / ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“
```

#### **å¼2ã®ç°¡ç•¥åŒ–: ä¾›å‡ºå¯èƒ½é›»åŠ›**

å…ƒã®å¼:
```
B_{n+1} Bid = ((B_n SOC_N - (B_n Bid - B_n Ref) Ã— (T-N)) / T) + B_{n+1} Ref
```

N = 0 ã‚’ä»£å…¥:
```
B_{n+1} Bid = ((B_n SOC_0 - (B_n Bid - B_n Ref) Ã— T) / T) + B_{n+1} Ref
            = (B_n SOC_0 / T) - (B_n Bid - B_n Ref) + B_{n+1} Ref
```

---

## ğŸ§® å…·ä½“çš„ãªè¨ˆç®—ä¾‹

### è¨­å®šæ¡ä»¶

```
è“„é›»æ± å®¹é‡ X = 10,000 Wh (10 kWh)
ç¾åœ¨ã®SOC = 5% â†’ å®¹é‡ = 500 Wh
ç›®æ¨™ã®SOC = 90% â†’ å®¹é‡ = 9,000 Wh
ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“ T = 3 æ™‚é–“
ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚º: N = 0
```

---

## ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—è¨ˆç®—

### ã‚¹ãƒ†ãƒƒãƒ—1: ç¾åœ¨å®¹é‡ã¨ç›®æ¨™å®¹é‡ã‚’è¨ˆç®—

```python
# å®¹é‡ã®è¨ˆç®—
X = 10000  # Wh (å®šæ ¼å®¹é‡)
SOC_current = 5  # %
SOC_target = 90  # %

# Whå˜ä½ã«å¤‰æ›
current_capacity = X * SOC_current / 100
target_capacity = X * SOC_target / 100

print(f"ç¾åœ¨å®¹é‡: {current_capacity} Wh")
print(f"ç›®æ¨™å®¹é‡: {target_capacity} Wh")
```

**çµæœ:**
```
ç¾åœ¨å®¹é‡: 500 Wh
ç›®æ¨™å®¹é‡: 9,000 Wh
```

---

### ã‚¹ãƒ†ãƒƒãƒ—2: å¿…è¦ãªå……é›»é‡ã‚’è¨ˆç®—

```python
delta_capacity = target_capacity - current_capacity
print(f"å¿…è¦ãªå……é›»é‡: {delta_capacity} Wh")
```

**çµæœ:**
```
å¿…è¦ãªå……é›»é‡: 8,500 Wh
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: åŸºæº–å€¤ã‚’è¨ˆç®—ï¼ˆå¼1ï¼‰

```python
T = 3  # æ™‚é–“
N = 0  # ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ç‚¹

# å¼1: B_{n+1} Ref = (X - B_n SOC_0) / T
# ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºãªã®ã§ã€ç¾åœ¨ã®SOCã‚’ä½¿ç”¨
B_ref = (target_capacity - current_capacity) / T

print(f"åŸºæº–å€¤ B_ref = ({target_capacity} - {current_capacity}) / {T}")
print(f"åŸºæº–å€¤ B_ref = {delta_capacity} / {T}")
print(f"åŸºæº–å€¤ B_ref = {B_ref} W")
print(f"åŸºæº–å€¤ B_ref = {B_ref/1000:.3f} kW")
```

**çµæœ:**
```
åŸºæº–å€¤ B_ref = (9000 - 500) / 3
åŸºæº–å€¤ B_ref = 8500 / 3
åŸºæº–å€¤ B_ref = 2833.33 W
åŸºæº–å€¤ B_ref = 2.833 kW
```

---

### ã‚¹ãƒ†ãƒƒãƒ—4: SOCå¤‰åŒ–é‡ã‚’æ¤œè¨¼

```python
# ã“ã®åŸºæº–å€¤ã§å……é›»ã—ãŸã¨ãã®SOCå¤‰åŒ–
charge_energy = B_ref * T  # Wh
delta_soc = charge_energy / X * 100  # %

print(f"å……é›»ã‚¨ãƒãƒ«ã‚®ãƒ¼: {charge_energy} Wh")
print(f"Î”SOC: {delta_soc}%")
print(f"æœ€çµ‚SOC: {SOC_current + delta_soc}%")
```

**çµæœ:**
```
å……é›»ã‚¨ãƒãƒ«ã‚®ãƒ¼: 8500.0 Wh
Î”SOC: 85.0%
æœ€çµ‚SOC: 90.0%
```

âœ… **ç›®æ¨™SOC 90% ã«åˆ°é”ï¼**

---

## ğŸ“ˆ è¦–è¦šçš„ãªèª¬æ˜

```
æ™‚é–“è»¸:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  t=0h          t=1h          t=2h          t=3h
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  GCæ™‚ç‚¹        å……é›»ä¸­         å……é›»ä¸­         ãƒ–ãƒ­ãƒƒã‚¯çµ‚äº†
  (æ±ºå®š)
  
SOCå¤‰åŒ–:
  5% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> 90%
     <â”€â”€â”€â”€â”€â”€â”€â”€ å……é›»: 2.833 kW â”€â”€â”€â”€â”€â”€â”€â”€>
     
     Î”SOC = +85%
     å……é›»é‡ = 8,500 Wh
     æ™‚é–“ = 3 æ™‚é–“
     åŸºæº–å€¤ = 8,500 / 3 = 2,833 W
```

---

## ğŸ’» å®Œå…¨ãªPythonã‚³ãƒ¼ãƒ‰ä¾‹

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
é–¢è¥¿é›»åŠ› ç‰¹è¨± JP 7377392 B1 ã®å¼ã®å®Ÿè£…ä¾‹
"""

def calculate_kansai_baseline(capacity_wh, soc_current_percent, 
                               soc_target_percent, block_hours):
    """
    é–¢è¥¿é›»åŠ›ã®ç‰¹è¨±å¼ã«åŸºã¥ãåŸºæº–å€¤è¨ˆç®—
    
    Args:
        capacity_wh: è“„é›»æ± å®šæ ¼å®¹é‡ [Wh]
        soc_current_percent: ç¾åœ¨ã®SOC [%]
        soc_target_percent: ç›®æ¨™SOC [%]
        block_hours: ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“ [h]
    
    Returns:
        dict: è¨ˆç®—çµæœ
    """
    # SOCã‚’å®¹é‡(Wh)ã«å¤‰æ›
    current_capacity = capacity_wh * soc_current_percent / 100
    target_capacity = capacity_wh * soc_target_percent / 100
    
    # å¿…è¦ãªå……é›»é‡
    delta_capacity = target_capacity - current_capacity
    
    # åŸºæº–å€¤ã®è¨ˆç®—ï¼ˆå¼1ï¼‰
    # B_{n+1} Ref = (X - B_n SOC_0) / T
    baseline_w = delta_capacity / block_hours
    
    # æ¤œè¨¼: ã“ã®åŸºæº–å€¤ã§ã©ã‚Œã ã‘SOCãŒå¤‰åŒ–ã™ã‚‹ã‹
    charge_energy = baseline_w * block_hours
    delta_soc = charge_energy / capacity_wh * 100
    final_soc = soc_current_percent + delta_soc
    
    return {
        'current_capacity_wh': current_capacity,
        'target_capacity_wh': target_capacity,
        'delta_capacity_wh': delta_capacity,
        'baseline_w': baseline_w,
        'baseline_kw': baseline_w / 1000,
        'charge_energy_wh': charge_energy,
        'delta_soc_percent': delta_soc,
        'final_soc_percent': final_soc
    }


# å®Ÿè¡Œä¾‹
if __name__ == "__main__":
    print("=" * 80)
    print("é–¢è¥¿é›»åŠ› ç‰¹è¨± JP 7377392 B1 - åŸºæº–å€¤è¨ˆç®—ä¾‹")
    print("=" * 80)
    print()
    
    # è¨­å®š
    capacity = 10000  # Wh (10 kWh)
    soc_current = 5   # %
    soc_target = 90   # %
    hours = 3         # h
    
    print(f"ã€å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€‘")
    print(f"  è“„é›»æ± å®¹é‡: {capacity} Wh ({capacity/1000} kWh)")
    print(f"  ç¾åœ¨SOC: {soc_current}%")
    print(f"  ç›®æ¨™SOC: {soc_target}%")
    print(f"  ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“: {hours} æ™‚é–“")
    print()
    
    # è¨ˆç®—å®Ÿè¡Œ
    result = calculate_kansai_baseline(capacity, soc_current, soc_target, hours)
    
    print(f"ã€è¨ˆç®—çµæœã€‘")
    print(f"  ç¾åœ¨å®¹é‡: {result['current_capacity_wh']:.0f} Wh")
    print(f"  ç›®æ¨™å®¹é‡: {result['target_capacity_wh']:.0f} Wh")
    print(f"  å¿…è¦å……é›»é‡: {result['delta_capacity_wh']:.0f} Wh")
    print()
    print(f"ã€åŸºæº–å€¤ï¼ˆå¼1ã®çµæœï¼‰ã€‘")
    print(f"  B_ref = {result['baseline_w']:.2f} W")
    print(f"  B_ref = {result['baseline_kw']:.3f} kW")
    print()
    print(f"ã€æ¤œè¨¼ã€‘")
    print(f"  å……é›»ã‚¨ãƒãƒ«ã‚®ãƒ¼: {result['charge_energy_wh']:.0f} Wh")
    print(f"  Î”SOC: {result['delta_soc_percent']:.2f}%")
    print(f"  æœ€çµ‚SOC: {result['final_soc_percent']:.2f}%")
    print()
    
    # æ¤œè¨¼
    if abs(result['final_soc_percent'] - soc_target) < 0.01:
        print("  âœ… ç›®æ¨™SOCã«åˆ°é”ã—ã¾ã—ãŸï¼")
    else:
        print(f"  âš ï¸ ç›®æ¨™SOCã¨ã®å·®: {result['final_soc_percent'] - soc_target:.2f}%")
    
    print()
    print("=" * 80)
```

---

## ğŸ¯ å®Ÿè¡Œçµæœ

```
================================================================================
é–¢è¥¿é›»åŠ› ç‰¹è¨± JP 7377392 B1 - åŸºæº–å€¤è¨ˆç®—ä¾‹
================================================================================

ã€å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€‘
  è“„é›»æ± å®¹é‡: 10000 Wh (10.0 kWh)
  ç¾åœ¨SOC: 5%
  ç›®æ¨™SOC: 90%
  ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“: 3 æ™‚é–“

ã€è¨ˆç®—çµæœã€‘
  ç¾åœ¨å®¹é‡: 500 Wh
  ç›®æ¨™å®¹é‡: 9000 Wh
  å¿…è¦å……é›»é‡: 8500 Wh

ã€åŸºæº–å€¤ï¼ˆå¼1ã®çµæœï¼‰ã€‘
  B_ref = 2833.33 W
  B_ref = 2.833 kW

ã€æ¤œè¨¼ã€‘
  å……é›»ã‚¨ãƒãƒ«ã‚®ãƒ¼: 8500 Wh
  Î”SOC: 85.00%
  æœ€çµ‚SOC: 90.00%

  âœ… ç›®æ¨™SOCã«åˆ°é”ã—ã¾ã—ãŸï¼

================================================================================
```

---

## ğŸ“‹ å¼ã®å¤‰æ›ã¾ã¨ã‚

### ä¸€èˆ¬å½¢ï¼ˆå¼1ï¼‰

```
B_{n+1} Ref = (X - (B_n SOC_N + B_n Ref Ã— (T-N))) / T
```

### ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ï¼ˆN=0ï¼‰

```
B_{n+1} Ref = (X - B_n SOC_0) / T
```

### å®Ÿç”¨çš„ãªå½¢ï¼ˆSOC â†’ å®¹é‡å¤‰æ›æ¸ˆã¿ï¼‰

```
åŸºæº–å€¤[W] = (ç›®æ¨™å®¹é‡[Wh] - ç¾åœ¨å®¹é‡[Wh]) / ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“[h]
```

### SOCå˜ä½ã§ã®è¡¨ç¾

```
åŸºæº–å€¤[W] = ((SOC_target[%] - SOC_current[%]) Ã— å®¹é‡[Wh] / 100) / æ™‚é–“[h]
```

### kWå˜ä½ã§ã®è¡¨ç¾ï¼ˆã‚ˆãä½¿ã†ï¼‰

```
åŸºæº–å€¤[kW] = (Î”SOC[%] Ã— å®¹é‡[kWh]) / (100 Ã— æ™‚é–“[h])
```

---

## ğŸ” é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

### 1. å®¹é‡ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—

é–¢è¥¿é›»åŠ›ã®å¼ã¯ **å®¹é‡ï¼ˆWhï¼‰ã‚’ãƒ™ãƒ¼ã‚¹** ã«ã—ã¦ã„ã¾ã™ï¼š
- X: å®šæ ¼å®¹é‡ [Wh]
- B_n SOC_N: æ®‹å®¹é‡ [Wh]

### 2. æ™‚é–“ã§å‰²ã‚‹

åŸºæº–å€¤ã¯ **é›»åŠ›ï¼ˆWï¼‰** ãªã®ã§ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼ˆWhï¼‰ã‚’æ™‚é–“ï¼ˆhï¼‰ã§å‰²ã‚‹ï¼š
```
é›»åŠ›[W] = ã‚¨ãƒãƒ«ã‚®ãƒ¼[Wh] / æ™‚é–“[h]
```

### 3. ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºã®é‡è¦æ€§

N=0ï¼ˆã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ç‚¹ï¼‰ã§ã¯å¼ãŒå¤§å¹…ã«ç°¡ç•¥åŒ–ã•ã‚Œã€
ç¾åœ¨ã®SOCã‹ã‚‰ç›´æ¥è¨ˆç®—ã§ãã‚‹ã€‚

---

## ğŸ’¡ å®Ÿç”¨ä¾‹: å¤§å®¹é‡ãƒãƒƒãƒ†ãƒªãƒ¼

### ä¾‹: 1968 kWhã€500 kW

```python
# è¨­å®š
capacity = 1968000  # Wh (1968 kWh)
soc_current = 5     # %
soc_target = 90     # %
hours = 3           # h

# è¨ˆç®—
result = calculate_kansai_baseline(capacity, soc_current, soc_target, hours)

print(f"åŸºæº–å€¤: {result['baseline_kw']:.2f} kW")
print(f"Î”SOC: {result['delta_soc_percent']:.2f}%")
```

**çµæœ:**
```
åŸºæº–å€¤: 557.80 kW
Î”SOC: 85.00%
```

**500kWã®åŸºæº–å€¤ã®å ´åˆ:**
```
Î”SOC = (500 Ã— 3) / 1968 Ã— 100 = 76.22%
â†’ SOC: 5% â†’ 81.22%ï¼ˆ90%ã«ã¯å±Šã‹ãªã„ï¼‰
```

---

## ğŸ“š ã¾ã¨ã‚

### é–¢è¥¿é›»åŠ›ã®ç‰¹è¨±å¼ï¼ˆå¼1ï¼‰

```
B_{n+1} Ref = (X - (B_n SOC_N + B_n Ref Ã— (T-N))) / T
```

### ã‚²ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºæ™‚ã®ç°¡ç•¥ç‰ˆ

```
B_{n+1} Ref = (ç›®æ¨™å®¹é‡ - ç¾åœ¨å®¹é‡) / ãƒ–ãƒ­ãƒƒã‚¯æ™‚é–“
```

### å…·ä½“ä¾‹ï¼ˆ10kWhã€5%â†’90%ã€3hï¼‰

```
åŸºæº–å€¤ = (9000 - 500) / 3
       = 8500 / 3
       = 2833.33 W
       = 2.833 kW
```

âœ… **ã“ã®åŸºæº–å€¤ã§3æ™‚é–“å……é›»ã™ã‚‹ã¨ã€SOCãŒ5%â†’90%ã«åˆ°é”ï¼**

---

ä½œæˆæ—¥: 2025å¹´11æœˆ5æ—¥  
å‚ç…§: ç‰¹è¨± JP 7377392 B1ã€ï¼ï¼ï¼˜ï¼’ã€‘æ®µè½
