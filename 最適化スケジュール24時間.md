# 最適化スケジュール - 24時間運用計画

## 🎯 最適化の目的

**SOCを90%以下に保ちながら、24時間で基準値（需要計画kW）の合計を最大化**

### 重要な制約

1. **SOC ≤ 90%** - SOCが90%に達したら、それ以上上げない
2. **SOCが90%到達後** - 基準値を0kWに設定して自然放電させる
3. **3時間ブロック** - 各基準値は3時間ごとに設定
4. **サイクル運用** - 90%到達 → 放電 → 再充電を繰り返す

---

## 📊 3つのシナリオ比較

### サマリー表

| シナリオ | 初期SOC | 最終SOC | 合計基準値 | 平均基準値 | 90%到達時刻 |
|---------|---------|---------|-----------|-----------|------------|
| **シナリオ1** | 5% | 84.1% | **3,280 kW** | 410 kW | 09:00 |
| **シナリオ2** | 30% | 84.1% | **2,629 kW** | 329 kW | 09:00 |
| **シナリオ3** | 70% | 84.1% | **1,588 kW** | 198 kW | 09:00 |

**結論**: 初期SOCが低いほど、24時間の合計基準値を高く設定できる！

---

## 📋 シナリオ1: 初期SOC 5% (最大基準値)

### 24時間スケジュール

| Block | 時間帯 | 開始SOC | 基準値 | 終了SOC | SOC変化 | 状態 |
|-------|--------|---------|--------|---------|---------|------|
| 1 | 06:00-09:00 | 5.0% | **2,365 kW** | 90.0% | +85.0% | ✅ 目標到達 |
| 2 | 09:00-12:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |
| 3 | 12:00-15:00 | 84.1% | **305 kW** | 90.0% | +5.9% | ✅ 目標到達 |
| 4 | 15:00-18:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |
| 5 | 18:00-21:00 | 84.1% | **305 kW** | 90.0% | +5.9% | ✅ 目標到達 |
| 6 | 21:00-00:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |
| 7 | 00:00-03:00 | 84.1% | **305 kW** | 90.0% | +5.9% | ✅ 目標到達 |
| 8 | 03:00-06:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |

**合計基準値: 3,280 kW**  
**平均基準値: 410 kW/block**

### 運用パターン
1. **初回充電** (06:00-09:00): 最大基準値2,365kWで5% → 90%に急速充電
2. **サイクル運用** (09:00以降): 
   - 放電フェーズ: 基準値0kWで90% → 84.1%に放電
   - 充電フェーズ: 基準値305kWで84.1% → 90%に充電
   - このサイクルを繰り返す

---

## 📋 シナリオ2: 初期SOC 30%

### 24時間スケジュール

| Block | 時間帯 | 開始SOC | 基準値 | 終了SOC | SOC変化 | 状態 |
|-------|--------|---------|--------|---------|---------|------|
| 1 | 06:00-09:00 | 30.0% | **1,714 kW** | 90.0% | +60.0% | ✅ 目標到達 |
| 2 | 09:00-12:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |
| 3 | 12:00-15:00 | 84.1% | **305 kW** | 90.0% | +5.9% | ✅ 目標到達 |
| 4-8 | (同様のサイクル) | ... | ... | ... | ... | ... |

**合計基準値: 2,629 kW**  
**平均基準値: 329 kW/block**

---

## 📋 シナリオ3: 初期SOC 70%

### 24時間スケジュール

| Block | 時間帯 | 開始SOC | 基準値 | 終了SOC | SOC変化 | 状態 |
|-------|--------|---------|--------|---------|---------|------|
| 1 | 06:00-09:00 | 70.0% | **673 kW** | 90.0% | +20.0% | ✅ 目標到達 |
| 2 | 09:00-12:00 | 90.0% | **0 kW** | 84.1% | -5.9% | ⬇️ 放電中 |
| 3 | 12:00-15:00 | 84.1% | **305 kW** | 90.0% | +5.9% | ✅ 目標到達 |
| 4-8 | (同様のサイクル) | ... | ... | ... | ... | ... |

**合計基準値: 1,588 kW**  
**平均基準値: 198 kW/block**

---

## 💡 重要な発見

### 1. SOCが90%に達した後の挙動

- **基準値0kW設定時のSOC変化**: -5.9%/3時間 (-1.97%/時間)
- **90% → 84.1%に自然放電**: 次のサイクルのために容量を確保
- **理由**: 基準値0kWでも、公式により `SOC変化率 = -1.9515%/時間` となるため

### 2. 最適なサイクル運用

```
充電 (305kW, 3時間) → SOC 84.1% → 90.0% (+5.9%)
   ↓
維持/放電 (0kW, 3時間) → SOC 90.0% → 84.1% (-5.9%)
   ↓
充電 (305kW, 3時間) → SOC 84.1% → 90.0% (+5.9%)
   ↓
   (繰り返し)
```

### 3. 基準値の計算式

- **初回充電**: `最適基準値 = ((90 - 現在SOC) / 3 + 1.9515) / 0.012804`
- **サイクル充電**: 常に **305 kW** (84.1% → 90.0%)
- **放電時**: 常に **0 kW** (90.0% → 84.1%)

---

## 📈 グラフファイル

以下の3つのHTMLファイルが生成されました：

1. **optimal_schedule_soc5.html** - 初期SOC 5%のグラフ
2. **optimal_schedule_soc30.html** - 初期SOC 30%のグラフ
3. **optimal_schedule_soc70.html** - 初期SOC 70%のグラフ

### グラフの内容

**上部グラフ**: 24時間のSOCと基準値の連続変化
- 青い線（塗りつぶし）: SOCの推移
- 緑の破線: 基準値の推移
- 赤い点線: 90%の目標上限

**下部グラフ**: 各3時間ブロックの詳細
- 緑の棒グラフ: 各ブロックの基準値
- 青い点と線: 開始SOC
- 紺色のダイヤと点線: 終了SOC

---

## 🎯 実用的な推奨事項

### 最大効率を得るための戦略

1. **朝6時の初期SOCをできるだけ低く**
   - 5%なら: 1日合計3,280kW
   - 30%なら: 1日合計2,629kW
   - 70%なら: 1日合計1,588kW

2. **90%到達後は必ず放電**
   - 基準値を0kWに設定
   - 3時間で84.1%まで自然放電
   - SOC変化: -5.9%

3. **サイクル運用の維持**
   - 充電: 305kW (84.1% → 90%)
   - 放電: 0kW (90% → 84.1%)
   - 3時間×2 = 6時間で1サイクル

4. **最初の3時間が最重要**
   - 初期SOCが低いほど高い基準値を設定可能
   - シナリオ1では2,365kW（全体の72%）を最初の3時間で稼ぐ

---

## 📊 データファイル

- **optimal_24h_schedules.csv** - 全スケジュールの詳細データ

---

## 🔬 使用した公式

```
SOC変化率 (%/時間) = 0.012804 × 基準値(kW) - 1.9515

相関係数 (R²) = 0.9997
```

この公式により、基準値とSOC変化の関係を正確に予測し、最適化を実現しました。
